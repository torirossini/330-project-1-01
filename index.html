
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Botany</title>
	<style>canvas{ border: 1px solid black; }
    
    .slidecontainer {
      width: 100%; /* Width of the outside container */
    }

    /* The slider itself */
    .slider {
      -webkit-appearance: none;  /* Override default CSS styles */
      appearance: none;
      width: 20%; /* Full-width */
      height: 25px; /* Specified height */
      background: #d3d3d3; /* Grey background */
      outline: none; /* Remove outline */
      opacity: 0.7; /* Set transparency (for mouse-over effects on hover) */
      -webkit-transition: .2s; /* 0.2 seconds transition on hover */
      transition: opacity .2s;
    }

    /* Mouse-over effects */
    .slider:hover {
      opacity: 1; /* Fully shown on mouse-over */
    }

    /* The slider handle (use -webkit- (Chrome, Opera, Safari, Edge) and -moz- (Firefox) to override default look) */
    .slider::-webkit-slider-thumb {
      -webkit-appearance: none; /* Override default look */
      appearance: none;
      width: 25px; /* Set a specific slider handle width */
      height: 25px; /* Slider handle height */
      background: #4CAF50; /* Green background */
      cursor: pointer; /* Cursor on hover */
    }

    .slider::-moz-range-thumb {
      width: 25px; /* Set a specific slider handle width */
      height: 25px; /* Slider handle height */
      background: #4CAF50; /* Green background */
      cursor: pointer; /* Cursor on hover */
    }
    </style>
	<script>
        "use strict";
        const canvasWidth = 400, canvasHeight = 300;
        let ctx;
        
        let slider, output;
        
        let flowers=[];

        let colorStyle = "green";
        let backgroundColor = "black";
        
        window.onload = init;
        
        function init(){
            ctx = canvas.getContext("2d");
            canvas.width = canvasWidth;
            canvas.height = canvasHeight;
            ctx.fillRect(0,0,canvasWidth,canvasHeight);
            slider = document.getElementById("myRange");
            output = document.getElementById("demo");
            output.innerHTML = slider.value;
            
            slider.oninput = function() {
                      output.innerHTML = this.value;
            }
            
            document.querySelector("#chooserBackgroundColor").onchange = function(e){
                backgroundColor = this.value;
                updateBackground(backgroundColor);
                console.log("changed background to " + colorStyle);
            };
            
            document.querySelector("#chooserColorStyle").onchange = function(e){
                colorStyle = this.value;
                console.log("changed color to " + colorStyle);
            };
            
            canvas.addEventListener('mousemove', function(evt) {
                var mousePos = getMousePos(canvas, evt);
                var message = 'Mouse position: ' + mousePos.x + ',' + mousePos.y;
                //console.log(message);
                
              }, false);
            
            //loop();
            canvas.onclick = canvasClicked;
		}

        function canvasClicked(e){
            let rect = e.target.getBoundingClientRect();
            let mouseX = e.clientX - rect.x;
            let mouseY = e.clientY - rect.y;
            console.log(mouseX,mouseY);
            
            
            //Add canvas click logic here
            
            //flowers.push(new Botany(mouseX, mouseY, 0,120,5,0,colorStyle).loop());
            
            
        }
        
        function updateBackground(color)
        {
            ctx.save();
            ctx.fillStyle = color;
            ctx.fillRect(0,0,canvasWidth,canvasHeight);
            ctx.restore();
        }
        
        function getMousePos(canvas, evt) {
            var rect = canvas.getBoundingClientRect();
            return {
              x: evt.clientX - rect.left,
              y: evt.clientY - rect.top
            };
          }

        class Botany{
            constructor(x,y,counter=0,fps=120, divergence=5, n=0, c=4, color="green"){
                    this.x = x;
                    this.y = y;
                    this.counter = counter;
                    this.fps = fps;
                    this.divergence = divergence;
                    this.n = n;
                    this.c = c;
                    this.color = color;
                    this.dtr = this.dtr.bind(this);
                    this.drawCircle = this.drawCircle.bind(this);
                    this.getColorAlgorithm = this.getColorAlgorithm.bind(this);
            }
        
            getColorAlgorithm(){
                if(this.color == "hsl")
                    {
                        let aDegrees = (this.n * this.divergence) % 361;
                        return `hsl(${aDegrees},100%,50%)`;
                    }
                else
                    {
                        return "green";
                    }
            }
            
            dtr(degrees){
                return degrees * (Math.PI/180);
            }

            drawCircle(ctx,x,y,radius,color){
                ctx.save();
                ctx.fillStyle = color;
                ctx.beginPath();
                ctx.arc(x,y,radius,0,Math.PI * 2);
                ctx.closePath();
                ctx.fill();
                ctx.restore();
            }  
            
            loop(){
                // each frame draw a new dot
                // `a` is the angle
                // `r` is the radius from the center (e.g. "Pole") of the flower
                // `c` is the "padding/spacing" between the dots
                let a = this.n * this.dtr(this.divergence);
                let r = this.c * Math.sqrt(this.n);
                //console.log(a,r);
                
                // now calculate the `x` and `y`
                let x = r * Math.cos(a) + this.x;
                let y = r * Math.sin(a) + this.y;
        
                let color = this.getColorAlgorithm();
                this.drawCircle(ctx,x,y,2,color);


                setTimeout(this.loop,1000/this.fps);
                this.n++;
            }


    }

	</script>
</head>
<body>
    <h1>Phyllotaxis Pencil </h1>
    <section>
        <button id="clearButton">Clear</button> 
        
        <button id="exportButton">Export</button>
    </section>
    <canvas id="canvas"></canvas>
    <div class="sliders">
       <div class="slidecontainer">
          <input type="range" min="1" max="100" value="50" class="slider" id="myRange">
          <p>Value: <span id="demo"></span></p>
        </div>

    </div>
    <div class="presets">
    <label>Background Color: 
      <select id="chooserBackgroundColor"> 
        <option value="red">Red</option>
        <option value="black" selected>Black</option>
        <option value="blue">Blue</option>
      </select>
    </label>
        
    <label>Color Style: 
      <select id="chooserColorStyle"> 
        <option value="hsl">HSL</option>
        <option value="green" selected>Green</option>
      </select>
    </label>
    </div>

</body>
</html>